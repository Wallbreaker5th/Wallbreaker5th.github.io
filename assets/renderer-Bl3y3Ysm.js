import{T as M,k as m,L as F,f as E,g as W}from"./app-D58D2pE6.js";class S{constructor({viewBox:e,scale:t,rotation:n,offsetX:s=0,offsetY:r=0,dontFlip:h=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=s,this.offsetY=r;const a=(e[2]+e[0])/2,i=(e[3]+e[1])/2;let d,o,l,u;switch(n%=360,n<0&&(n+=360),n){case 180:d=-1,o=0,l=0,u=1;break;case 90:d=0,o=1,l=1,u=0;break;case 270:d=0,o=-1,l=-1,u=0;break;case 0:d=1,o=0,l=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(l=-l,u=-u);let p,w,f,g;d===0?(p=Math.abs(i-e[1])*t+s,w=Math.abs(a-e[0])*t+r,f=(e[3]-e[1])*t,g=(e[2]-e[0])*t):(p=Math.abs(a-e[0])*t+s,w=Math.abs(i-e[1])*t+r,f=(e[2]-e[0])*t,g=(e[3]-e[1])*t),this.transform=[d*t,o*t,l*t,u*t,p-d*t*a-l*t*i,w-o*t*a-u*t*i],this.width=f,this.height=g}get rawDims(){const{viewBox:e}=this;return{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]}}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new S({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}static applyTransform(e,t){const n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,r]}convertToViewportPoint(e,t){return S.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=S.applyTransform([e[0],e[1]],this.transform),n=S.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return S.applyInverseTransform([e,t],this.transform)}}class H{constructor(e,t,n){this.pageInfos=e,this.imageScaleFactor=n.pixelPerPt??M.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.annotationLayerList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const s=(r,h,a,i)=>{const d=this.canvasList[r]=document.createElement("canvas"),o=this.semanticLayerList[r]=document.createElement("div"),l=this.textLayerList[r]=document.createElement("div"),u=this.textLayerParentList[r]=document.createElement("div"),p=this.annotationLayerList[r]=document.createElement("div");if(d.getContext("2d")){const f=document.createElement("div");d.width=h,d.height=a,f.appendChild(d),i.appendChild(f),f.style.position="absolute"}{u.appendChild(l),u.className="text-layer textLayer";const f=t.offsetWidth,g=f/h;u.style.width=`${f}px`,u.style.height=`${a*g}px`,u.style.position="absolute",p.style.width=`${f}px`,p.style.height=`${a*g}px`,p.style.position="absolute",i.classList.add("typst-page"),i.classList.add("canvas"),i.style.width=`${f}px`,i.style.height=`${a*g}px`,i.style.position="relative",o.appendChild(u),o.appendChild(p),i.appendChild(o)}};for(let r=0;r<this.pageInfos.length;r++){const h=this.pageInfos[r],a=Math.ceil(h.width)*this.imageScaleFactor,i=Math.ceil(h.height)*this.imageScaleFactor;let d;d=this.commonList[r]=document.createElement("div"),t.appendChild(d),s(r,a,i,d)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],n=Math.ceil(t.width)*this.imageScaleFactor,s=Math.ceil(t.height)*this.imageScaleFactor,r=this.canvasList[e].parentElement;if(!r)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const h=this.commonList[e],a=this.textLayerParentList[e],i=this.annotationLayerList[e],d=this.container.offsetWidth,o=d/n;a.style.width=`${d}px`,a.style.height=`${s*o}px`,i.style.width=`${d}px`,i.style.height=`${s*o}px`,h.style.width=`${d}px`,h.style.height=`${s*o}px`;const l=this.container.offsetWidth/n;r.style.transformOrigin="0px 0px",r.style.transform=`scale(${l})`}}}function q(c,e,t,n,s){const r=e.offsetWidth,h=performance.now(),a=(d,o)=>{var _;const l=t[o];if(!l){console.error("page not found for",o);return}const u=l.width,p=l.height,w=r/u,f=Number.parseFloat(w.toFixed(4));(_=d.parentElement)==null||_.style.setProperty("--scale-factor",f.toString());const g=new S({viewBox:[0,0,u,p],scale:f,offsetX:0,offsetY:0,rotation:0,dontFlip:!1});c.renderTextLayer({textContentSource:s[o],container:d,viewport:g})};n.forEach(a);const i=performance.now();console.log(`text layer used: render = ${(i-h).toFixed(1)}ms`)}var C;(function(c){c[c.Doc=0]="Doc",c[c.Slide=1]="Slide"})(C=C||(C={}));class R{constructor(e){var t,n;this.modes=[],this.partialRendering=!0,this.renderMode="svg",this.r=void 0,this.previewMode=C.Doc,this.isContentPreview=!1,this.isMixinOutline=!1,this.backgroundColor="black",this.pageColor="white",this.pixelPerPt=3,this.isRendering=!1,this.moduleInitialized=!1,this.patchQueue=[],this.disposeList=[],this.currentRealScale=1,this.currentScaleRatio=1,this.vpTimeout=void 0,this.sampledRenderTime=0,this.partialRenderPage=0,this.outline=void 0,this.cursorPosition=void 0,this.cachedDOMState={width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0}},this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:s,previewMode:r,isContentPreview:h,retrieveDOMState:a}=e||{};this.partialRendering=!1,this.renderMode=s??this.renderMode,this.previewMode=r??this.previewMode,this.isContentPreview=h||!1,this.retrieveDOMState=a??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===C.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(n=this.hookedElem.parentElement)==null||n.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((n,s)=>(n[s]=e[`${s}$${t}`].bind(e),console.assert(n[s]!==void 0,`${s}$${t} is undefined`),n),{})}registerMode(e){const t=R.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=n=>{var s,r,h,a;if(n.ctrlKey){n.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);const i=this.currentScaleRatio;if(n.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(p=>p>this.currentScaleRatio).at(0)}else if(n.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(p=>p<this.currentScaleRatio).at(-1)}else return;const d=this.currentScaleRatio/i,o=n.pageX*(d-1),l=n.pageY*(d-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(s=this.hookedElem.parentElement)==null||s.classList.add("hide-scrollbar-x"),this.previewMode===C.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(h=this.hookedElem.parentElement)==null||h.classList.remove("hide-scrollbar-x"),this.previewMode===C.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(a=this.hookedElem.parentElement)==null||a.classList.remove("hide-scrollbar-y")));const u=this.hookedElem.firstElementChild;if(u){const p=this.getSvgScaleRatio(),w=Number.parseFloat(u.getAttribute("data-height")),f=Math.ceil(w*p);this.hookedElem.style.height=`${f*2}px`}return window.scrollBy(o,l),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi<"u"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,n=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),s=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===C.Slide?Math.min(t.width/n,t.height/s):t.width/n,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now();const n=this.canvasRenderCToken;n&&(await n.cancel(),await n.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let s=!1;for(;this.patchQueue.length>0;)s=this.processQueue(this.patchQueue.shift())||s;let r=performance.now();s&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let h=performance.now();const a=(i,d,o)=>`${i} ${(o-d).toFixed(2)} ms`;this.sampledRenderTime=h-t,console.log([a("parse",t,r),a("rerender",r,h),a("total",t,h)].join(", ")),requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===C.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}}function V(c){return class{constructor(t){if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new c(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,n,s){this.impl.cursorPosition=[t,n,s]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function N(c,...e){return e.reduce((t,n)=>n(t),c)}class K{constructor(){this.isCancellationRequested=!1;let e,t;this._onCancelled=new Promise(n=>{e=n,t&&t(n)}),this._onCancelledResolveResolved=new Promise(n=>{t=n,e&&n(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}const X=()=>new Promise(c=>requestAnimationFrame(c));var b;(function(c){c[c.Doc=0]="Doc",c[c.Pages=1]="Pages"})(b||(b={}));var y;(function(c){c[c.Layout=0]="Layout",c[c.Svg=1]="Svg",c[c.Semantics=2]="Semantics",c[c.PrepareCanvas=3]="PrepareCanvas",c[c.Canvas=4]="Canvas"})(y||(y={}));function Y(c){return class extends c{constructor(...t){if(super(...t),this.tmpl=document.createElement("template"),this.stub=this.createElement("<stub></stub>"),this.resourceHeader=void 0,this.pages=[],this.domScale=1,this.track_mode=b.Doc,this.current_task=void 0,this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const t of this.pages)t.dispose();this.docKernel&&this.docKernel.free()}createElement(t){return this.tmpl.innerHTML=t,this.tmpl.content.firstElementChild}async mountDom(t){if(console.log("mountDom",t),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[m],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:n=>{let s=this.createElement(n);console.log("populateGlyphs",s);let r=s.firstElementChild;this.resourceHeader.append(r)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){const t=this.current_task;this.current_task=void 0,await t.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(t,n){const s=n.left,r=-n.top,h=t.innerWidth,a=t.innerHeight-n.top,i={x:0,y:r/this.domScale,width:Math.max(h-s,0)/this.domScale,height:Math.max(a-r,0)/this.domScale};return(i.width<=0||i.height<=0)&&(i.x=i.y=i.width=i.height=0),i}async rerender$dom(){const t=this.retrieveDOMState(),{x:n,y:s,width:r,height:h}=this.getDomViewport(t.window,t.boundingRect);if(!await this.docKernel.relayout(n,s,r,h))return;const i=new K;this.doRender$dom(i),this.current_task=i}async doRender$dom(t){const n=(a,i)=>{if(a&&!t.isCancelRequested()&&i)return i()},s=this.retrieveDOMPages().map(a=>{const{innerWidth:i,innerHeight:d}=window,o=a.getBoundingClientRect();return{inWindow:!(o.left>i||o.right<0||o.top>d||o.bottom<0),page:a}}),r=async a=>{if(await X(),t.isCancelRequested()){console.log("cancel stage",y.Layout,a);return}const i=s[a].page,d=i.getBoundingClientRect(),o=this.getDomViewport(window,d),l=g=>this.docKernel.need_repaint(a,o.x,o.y,o.width,o.height,g),u=g=>this.docKernel.repaint(a,o.x,o.y,o.width,o.height,g),p=g=>{if(!t.isCancelRequested())return n(l(g),()=>u(g))};await p(y.Layout);const w=(d.width?Number.parseFloat(i.getAttribute("data-width"))/d.width:1)*this.domScale,f=(d.height?Number.parseFloat(i.getAttribute("data-height"))/d.height:1)*this.domScale;if(o.x*=w,o.y*=f,o.y-=100,o.width*=w,o.height*=f,o.height+=200,await p(y.Svg),await p(y.Semantics),t.isCancelRequested()){console.log("cancel stage",y.Semantics,a);return}l(y.PrepareCanvas)?(async()=>{if(await u(y.PrepareCanvas),!t.isCancelRequested())return p(y.Canvas)})():await p(y.Canvas)},h=async a=>{for(let i=0;i<s.length;++i){if(t.isCancelRequested()){console.log("cancel page",y.Layout,i);return}s[i].inWindow===a&&await r(i)}};this.cancelAnyway$dom(),await h(!0),await h(!1),!t.isCancelRequested()&&console.log("finished",y.Layout)}}}class Q extends V(N(R,Y)){}class P{constructor(e,t){this.plugin=e,this[m]=t}set backgroundColor(e){e!==void 0&&(this[m].background_color=e)}get backgroundColor(){return this[m].background_color}set pixelPerPt(e){e!==void 0&&(this[m].pixel_per_pt=e)}get pixelPerPt(){return this[m].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[m].doc_width}get docWidth(){return this[m].doc_width}get doc_height(){return this[m].doc_height}get docHeight(){return this[m].doc_height}retrievePagesInfo(){const e=this[m].pages_info,t=[],n=e.page_count;for(let s=0;s<n;s++){const r=e.page(s);t.push({pageOffset:r.page_off,width:r.width_pt,height:r.height_pt})}return t}getSourceLoc(e){return this[m].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[m].source_span(e)}render_in_window(e,t,n,s){return this[m].render_in_window(e,t,n,s)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}}const z=new F(async c=>await(await E(()=>import("./wasm-pack-shim-B7WHyCkS.js"),__vite__mapDeps([]))).default(c));function Z(c){return new T(c||void 0)}function ee(){return new T(void 0)}async function te(){return(await E(()=>import("./wasm-pack-shim-B7WHyCkS.js"),__vite__mapDeps([]))).renderer_build_info()}function j(c){return Math.random().toString(36).replace("0.",c||"")}let k=!0;class T{constructor(e){this.pdf=e}async init(e){this.rendererJs=await E(()=>import("./wasm-pack-shim-B7WHyCkS.js"),__vite__mapDeps([]));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await W(e,z,t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>{const n=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset!==void 0&&(n.page_off=e.pageOffset),e.cacheKey!==void 0&&(n.cache_key=e.cacheKey),e.dataSelection!==void 0){let s=0;e.dataSelection.body?s|=1:e.canvas&&k&&(k=!1,console.warn("dataSelection.body is not set but providing canvas for body")),e.dataSelection.text&&(s|=2),e.dataSelection.annotation&&(s|=4),n.data_selection=s}return this.renderer.render_page_to_canvas(t[m],e.canvas||void 0,n)})}async inAnimationFrame(e){return new Promise((t,n)=>{requestAnimationFrame(()=>{try{t(e())}catch(s){n(s)}})})}async renderDisplayLayer(e,t,n,s){const h=e[m].pages_info.page_count,a=async(i,d)=>{const l=n[i].getContext("2d");if(!l)throw new Error("canvas context is null");return await this.renderCanvas({canvas:l,renderSession:e,pageOffset:d})};return this.inAnimationFrame(async()=>{const i=performance.now(),d=(await Promise.all([(async()=>{const l=[];for(let u=0;u<h;u++)l.push(await a(u,u));return l})()]))[0],o=performance.now();return console.log(`display layer used: render = ${(o-i).toFixed(1)}ms`),d})}renderTextLayer(e,t,n,s,r){q(this.pdf,n,t.pageInfos,s,r)}renderAnnotationLayer(e,t,n,s,r){const h=t.pageInfos,a=performance.now(),i=(o,l)=>{const u=h[l];if(!u){console.error("page not found for",l);return}const p=u.width,w=u.height;o.innerHTML="";for(const f of r[l].links){const g=document.createElement("div"),_=f.annotation_box.transform[4]/p*100,D=f.annotation_box.transform[5]/w*100,$=f.annotation_box.transform[1],O=f.annotation_box.transform[2];switch(g.className="typst-annotation",g.style.width=`${f.annotation_box.width/p*100}%`,g.style.height=`${f.annotation_box.height/w*100}%`,g.style.left=`${_}%`,g.style.top=`${D}%`,g.style.transform=`matrix(1, ${$}, ${O}, 1, 0, 0)`,f.action.t){case"Url":{const v=document.createElement("a");v.href=f.action.v.url,v.target="_blank",v.appendChild(g),o.appendChild(v);break}case"GoTo":{const v=document.createElement("div");v.className="typst-annotation";const A=f.action.v.x/p*100,I=f.action.v.y/w*100;v.style.left=`${A}%`,v.style.top=`${I}%`;const x=j("lnk-");v.id=x,s[f.action.v.page_ref-1].appendChild(v);const L=document.createElement("a");L.href=`#${x}`,L.appendChild(g),o.appendChild(L);break}default:console.warn("unknown action",f);break}}};s.forEach(i);const d=performance.now();console.log(`annotation layer used: render = ${(d-a).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{const n=new Q({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await n.impl.mountDom(e.pixelPerPt),n})}async renderToCanvas(e){let t,n;const s=e.container;s.style.visibility="hidden";const r=async(h,a)=>{try{n=await this.renderDisplayLayer(t,s,h,e),a()}finally{s.style.visibility="visible"}};return this.withinOptionSession(e,async h=>{if(t=h,t[m].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let a=e.backgroundColor;if(a!==void 0&&!/^#[0-9a-f]{6}$/.test(a))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+a);t.pixelPerPt=e.pixelPerPt??M.PIXEL_PER_PT,t.backgroundColor=a??"#ffffff";const i=performance.now(),d=new H(this.retrievePagesInfoFromSession(t),s,e),o=performance.now();console.log(`layer used: retieve = ${(o-i).toFixed(1)}ms`),await r(d.canvasList,()=>d.resetLayout()),this.renderTextLayer(t,d,s,d.textLayerList,n.map(l=>l.textContent)),this.renderAnnotationLayer(t,d,s,d.annotationLayerList,n.map(l=>l.annotationList))})}createModule(e){return Promise.resolve(new P(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}renderSvg(e,t){if(e instanceof P||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async n=>{let s;return e.data_selection&&(s=0,e.data_selection.body&&(s|=1),e.data_selection.defs&&(s|=2),e.data_selection.css&&(s|=4),e.data_selection.js&&(s|=8)),Promise.resolve(this.renderer.svg_data(n[m],s))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[m],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[m],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[m],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[m]))}resetSession(e){return this.renderer.reset(e[m])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[m],e.action??"reset",e.data)}withinOptionSession(e,t){function n(s){return"artifactContent"in s}if("renderSession"in e)return t(e.renderSession);if(n(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let n=e,s=t;t||(n=void 0,s=e);const r=this.renderer.create_session(n&&this.createOptionsToRust(n));try{const h=await s(new P(this,r));return r.free(),h}catch(h){throw r.free(),h}}}export{P as RenderSession,T as TypstRendererDriver,Z as createTypstRenderer,ee as createTypstSvgRenderer,te as rendererBuildInfo};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
